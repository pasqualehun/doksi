\chapter{Bevezetés}

A pilóta nélküli légijármû, azaz UAV (Unamanned Aerial Vehicle) \cite{bib:uav} gondolata egészen a XX. század elejére nyúlik vissza, amikor az I. világháborúban egy olyan távirányítású repülõt alkottak, amely robbanószerrel a fedélzetén a célpontba csapódva okozott kárt.
Késõbb a vietnámi háborúban az UAV-k több mint 3000 küldetésben vettek részt. Akkoriban a technológiai korlátok miatt az alkalmazott UAV-k fõ funkcionalitása videófelvétel készítése volt. Az akkori eszközök egy meghatározott útvonalat tudtak berepülni (ami tipikusan egyenes szakaszokkal leírt pálya volt, egyes pontokon a megfigyelés érdekében körökkel kiegészítve) repülve, majd a bevetés végén a bázisra való visszaérkezés volt az utolsó feladatuk.

Idõvel a technika fejlõdésének köszönhetõen az UAV-k egyre összetettebb feladatok elvégzésére lettek képesek. A fejlettek rádiótechnika által biztosított nagyobb átviteli sebességnek köszönhetõen lehetõvé vált, hogy a gépet irányító operátor valós idõben, monitoron keresztül kezelhesse a távirányítású légijármûvet. A korszerû UAV-k ezért több üzemmódot is támogatnak, amelyek között megtalálható az említett távirányítás, valamint a fedélzeti intelligenciára támaszkodó önálló repülés, azaz az autonóm mûködés is. Az alkalmazási területek köre is szélesebb lett, így a katonai feladatok mellett a polgári repülés, a mezõgazdaság és a katasztrófaelhárítás is rendszeresen alkalmaz ma már pilóta nélküli légijármûveket. 

Az autonóm mûködés emellett a pilóta által vezetett katonai és polgári repülõgépekben is egyre szélesebb felhasználási teret nyert. Ennek oka, hogy fontos és célszerû is az emberi terhelés csökkentése, ezzel növelve a repülésbiztonságot és csökkentve a költségeket. Utasszállító gépek esetében például a robotpilóta elvégez minden olyan korrekciót, amelyhez azelõtt a pilóta folyamatos figyelme, koncentrációja volt szükséges. Ám hiába a fejlett eszközháttér, mind a pilótával, mind a pilóta nélkül repülõ légijármûvek teljes körû automatikus üzemeltetése egyelõre távoli cél. Ma még az emberi beavatkozásnak rendelkezésre kell állnia olyan helyzetekben, amelyekre nincs elõre felkészítve az az automatikus irányítórendszer. UAV-k esetében ilyen beavatkozásokhoz létfontosságú, hogy az operátor lássa a gép aktuális pozícióját, diagnosztikai adatait. Ezt a feladatot látja el az ún. földi irányító állomás, azaz GCS (Ground Control Station). Szakdolgozatom célja egy meglevõ pilóta nélküli légijármû földi irányító állomásának megtervezése és elkészítése, a megbízható mûködés követelményeinek figyelembe vételével.

\section{Motiváció}


Az MTA SZTAKI Rendszer és Irányításelméleti Kutatólaboratóriumában folyó kutatások eredményének demonstrálásához szükség volt egy kézzelfogható eszköz megalkotására. A kifejlesztett szabályozó algoritmusok mûködésének bemutatásának az egyik látványos módja egy autonóm  repülõgép megépítése. Az autonóm légijármû stabil repülési tulajdonságait garantáló algoritmusok kidolgozásához és implementálásához elengedhetetlen a kormányszervek harmonikus mozgatása és a tolóerõ szabályozása. Abban az esetben, ha a repülõgépet feladatokkal látjuk el, pl. fordulópontokat követve feltérképezni egy elõre kijelölt területet, már számolni kell a széllel, ami eltérítheti az útvonaláról. Fontos, hogy az ehhez hasonló környezeti hatásokra a gép megfelelõen reagáljon.

Mivel egy teljesen felszerelt repülõ összeállítása, felprogramozása nagy szakértelmet, sok idõt, energiát és nem utolsó sorban anyagi ráfordítást igényel, egy esetleges meghibásodás jelentõs kárt okozna. Ezen okok miatt felmerült az igény a repülõ megbízhatóságának növelésére. Így a most folyamatban lévõ ``Nagy megbízhatóságú pilóta nélküli légijármû projekt'' keretében egy olyan avionikai rendszer fejlesztése is folyik, amelynek célja minden egyes repülõgép alrendszer meghibásodásának diagnosztizálása és ezen diagnosztikai információkat felhasználva a repülõgép átkonfigurálása. 

Feladatom tehát egy olyan -- grafikus felhasználói felülettel ellátott -- földi irányító állomás kifejlesztése egy biztonságkritikus robotrepülõhöz, amely képes redundáns kommunikációs csatornán küldött adatok kezelésére és megjelenítésére. Ehhez több részfeladat megoldása is szükséges. Elsõ lépésként meg kell oldanom a kapcsolatot biztosító modem jeleinek vételét. Mivel a robotrepülõgép hibatûrõ kialakítása révén ez az egység is redundánsan szerelt, így az adatok két független csatornán, párhuzamosan érkeznek a földi irányító állomáshoz. Mivel az így beérkezõ adatok szükségszerûen eltérnek egymástól, ennek az eltérésnek a kijelzése és kezelése is megvalósítandó.
Feladatom tehát egy olyan -- grafikus felhasználói felülettel ellátott -- földi irányító állomás kifejlesztése egy biztonságkritikus robotrepülõhöz, amely képes redundáns kommunikációs csatornán küldött adatok kezelésére és megjelenítésére. Ehhez több részfeladat megoldása is szükséges. Elsõ lépésként meg kell oldanom a kapcsolatot biztosító modem jeleinek vételét. A repülõgép hibatûrõ kialakítása révén ez az egység is redundánsan szerelt, így az adatok két független csatornán, párhuzamosan érkeznek a földi irányító állomáshoz. Mivel az így beérkezõ adatok szükségszerûen eltérnek egymástól, ennek az eltérésnek a kijelzése és kezelése is megvalósítandó.
Továbbá, a földi irányító állomáshoz a repülõt távolról megfigyelõ és szükség szerint irányító földi személyzet kiszolgálására készül, így a legfontosabb cél, hogy õk a repülõvel kapcsolatos információkat könnyen értelmezhessék, és az esetleges meghibásodásokról is idõben értesüljenek.

\section{Elõzmények}

A jelenlegi repülõ egy az MTA SZTAKI munkatársai által épített 3.2 m fesztávolságú modell, amelybe diagnosztikai és hibadetekciós célokra egyedi tervezésû komponenseket szereltek be. Figyelembe véve, hogy a kereskedelmi forgalomban beszerezhetõ szervó motorok nem szolgálnak elég információval a kitérésükrõl, fogyasztásukról, gondoskodni kellett ezen adatok mérhetõségérõl.


\subsection{Az MTA SZTAKI ORCA 2 felépítése}


\begin{figure}[H]
	\centering
	\resizebox{12cm}{!}{
		\includegraphics{figures/orca.png}}
	\caption{MTA SZTAKI ORCA 2}
	\label{fig:sys}
\end{figure}


\subsubsection{Architektúra}

A MTA SZTAKI ``Nagy megbízhatóságú pilóta nélküli légijármû'' projektjében  elsõdleges szempont, hogy egy komponens meghibásodása ne okozza a gép vesztét, tehát a rendszerben ne maradjon SPOF (Single Point Of Failure)\footnote{olyan meghibásodás, mely ha bekövetkezik, az egész rendszer hibás mûködéséhez vezet}. Ezt redundanciával érhetjük el, azaz a repülõgépen duplikáljuk azokat az elemeket, melyek nélkülözhetetlenek a levegõben maradáshoz:
\begin{itemize}
\item motor
\item kormányfelületek és ezeket mozgató motorok
\item tápellátás
\item központi számítógép
\end{itemize}

\setlength{\parindent}{0cm}
A \figref{sys} ábrán látható a kialakított architektúra. Elemei:
\setlength{\parindent}{0.5cm}

\begin{itemize}
\item \textbf{FCC} (Flight Control Computer) repülõgép irányítása
\item \textbf{NAV} (Navigation) GPS, nyomásmérõ, orientációmérõ
\item \textbf{MOD} (Modem) modem, kommunikáció
\item \textbf{Gateway} CAN-FlexRay átjáró
\item \textbf{PWR} (Power) feszültségválasztó
\item \textbf{S1, S2, S3, S4} (Servo) kormányfelületeket mozgató szervó motorok
\item \textbf{SX1, SX2, SX3, SX4} szervó motorok szabályzóelektronikája
\item \textbf{M1, M2} (Motor) motorok
\item \textbf{MX1, MX2} motorok szabályzóelektronikája
\item \textbf{RC} (Remote Control) távvezérlõ egység, manuális vezérlés
\item \textbf{PIC} (PIC Microcontroller) PWM (Pulse-Width Modulation)\footnote{impulzusszélesség moduláció, mely a szabályzást nem feszültségszint növelésével, hanem annak idõtartamával éri el}-CAN (Controller Area Network)\footnote{egy számítógépes hálózati protokoll és adatbusz szabvány melyet mikrokontrollerek és egyéb gazdaszámítógép nélkül mûködõ eszközök kommunikációjára terveztek \cite{bib:canwiki}} átalakítás

\end{itemize}
\begin{figure}[H]
	\centering
	\resizebox{13cm}{!}{
		\includegraphics{figures/sys.png}}
	\caption{}
	\label{fig:sys}
\end{figure}

A központi számítógépek (ábrán zölddel jelölve 1-es 2-es) 1--1 szendvics panelen helyezkednek el, központi elemük az FCC, mely az irányításért felelõs. A navigációs eszköz szolgáltatja a GPS-bõl érkezõ magasság és pozíció adatokat, illetve egy, az ábrán nem látható IMU (Inertial Measurement Unit)\footnote{orientáció- és gyorsulásmérõ berendezés}-ból érkezõ orientáció és gyorsulás értékeket. A navigációs egységen egy mikrokontroller elõfeldolgozást végez, így már csak a ténylegesen feldolgozandó információval kell az FCC-nek számolnia. Az FCC és a NAV közötti kommunikáció CAN buszon keresztül zajlik. Az ábrán látható S és M-mel jelölt elemek rendre a kormányfelületeket mozgató szervó motorok és a meghajtásért felelõs motorok. Ezek az elemek redundáns FlexRay kommunikációs csatornán kapják az utasításokat az FCC-bõl.

A CAN--FlexRay és FlexRay--CAN átalakítást a Gateway egység végzi. A szervók és motorok nem szolgálnak elég információval saját állapotukról, így ezeket átalakították, hogy a FlexRay hálózatra illesztésért felelõs szabályozóelektronika megfelelõen mûködhessen. Ezekre bármilyen szabályzóalgoritmus írható, hibadiagnosztikai célokra fault detection filter-t vagy Kármán szûrõ alkalmazható. A szervók mágneses enkódere a kitérésrõl, a motorok elektronikája a fogyasztásról ad információt. 

Hibatûrésbõl adódóan az energiaforrások is redundánsan szerepelnek, a központi számítógépek a B3 és B4-gyel jelölt akkumulátorból nyerhetnek energiát, a választást a PWR néven jelzett egység végzi. Különbözõ stratégiák választhatók az akkumulátor átkapcsolását illetõen. Lehetséges mindig a legnagyobb feszültséggel operálót választani vagy egyiket lemeríteni bizonyos százalékig és ezután váltani. A B5 és B6 jelzésû akkumulátorok a legnagyobb fogyasztású egységeket, azaz a motorokat hivatottak kiszolgálni, ezért ezek kapacitása a legnagyobb. A B1 és B2 akkumulátor biztosítja a beavatkozó szervek, és a hozzájuk tartozó vezérlõelektronikáknak az áramforrást.

A repülõgép jelenleg csak távirányítással tud felszállni, így a távvezérlõ egység és a PWM-CAN átalakításért felelõs PIC egység is ezt a két akkumulátort használja. A PIC közvetlenül a szabályzó elektronikákhoz csatlakozik CAN buszon, mivel jelen felépítésben ez a legközvetlenebb módja a kézi irányításnak.

Dolgozatom szempontjából a legérdekesebb egység a modem mely az FCC-vel soros porton kommunikál.


\subsubsection{Vezeték nélküli kommunikáció}

A fedélzeti MOD egységek XBee-PRO 868 típusú modemek \cite{bib:xbee} (lásd \figref{xbee} ábra), melyek alacsony fogyasztásuk és nagy hatótávolságuk miatt ideálisak egy szûkös energiaforrással rendelkezõ robotrepülõbe. Ugyanilyen modemek csatlakoznak a földi irányító egységhez, melyek a fedélzeti modemekhez hasonlóan soros porton keresztül küldik a vett jeleket. A modempárok közötti vezeték nélküli protokoll: 802.15.4, amivel a \sectref{prot} fejezet foglalkozik.

A kiválasztott XBee-PRO 868 modem kétféleképpen képes kommunikálni a csatlakoztatott eszközzel:

\begin{itemize}
\item AT transzparens
\item API (Application Programming Interface)\footnote{elõre megírt komponensek használatához biztosít interfészt} csomagküldés
\end{itemize}

\begin{description}
\item[AT:] Alapértelmezetten transzparens módon zajlik a kommunikáció a modemhez csatlakoztatott eszköz és a modem között \cite{bib:startxbee}. Ennek lényege, hogy a csatlakoztatott eszköz számára a kommunikáció ugyanúgy zajlik, mintha soros protokollon keresztül megvalósított közvetlen összeköttetésben állna másik eszközzel. A modem a soros portján bejövõ üzeneteket rádiójelekké alakítja, melyet a virtuális kapcsolat végpontja fogad és visszaalakít. Egy pont-pont kapcsolat kiépítése ebben a módban a legegyszerûbb. 

\item[API:] API mód lényege, hogy a csatlakoztatott eszköz a modem által biztosított API-n keresztül kommunikál. Az AT módhoz képest nagyobb rugalmasságot biztosít, mivel egy csomag a programozó szándéka szerint tartalmazhatja a küldõ és fogadó eszköz címét, a csomag típusát, checksum-ját. A küldõ fél a csomagok megérkezésérõl ACK (Acknowledgement)\footnote{nyugtázó üzenet, melyet a fogadó küld a feladónak egy csomag sikeres vétele esetén} jelzéssel bizonyosodhat meg, ennek elmaradásnál újbóli küldés lehetséges.
A csomagok többletinformációjával lehetséges broadcast üzenetek\footnote{olyan üzenet, melyet egy csomópont az összes vele kapcsolatban álló csomópontnak elküld} küldése, egy-több kapcsolat felépítése.
\end{description}
\begin{figure}[H]
	\centering
	\resizebox{5cm}{!}{
		\includegraphics{figures/xbee.png}}
	\caption{XBee-PRO 868}
	\label{fig:xbee}
\end{figure}

\subsubsection{IEEE 802.15.4 vezeték nélküli protokoll}
\label{sect:prot}
Az IEEE (Institute of Electrical and Electronics Engineers)-nek egy szabványa a 802.15, mely a WPAN (Wireless Personal Area Network) hálózatokkal foglalkozik. Hét alcsoportja közül a 802.15.4 \cite{bib:ieee} a Low-Rate WPAN nevet viseli. Ez a szabvány a kis fogyasztású, olcsó és alacsony sávszélességû vezeték nélküli kommunikációt foglalja magában. Az OSI (Open Systems Interconnection)\footnote{rétegekbe szervezett rendszer absztrakt leírása, ami a számítógépek kommunikációjához szükséges hálózati protokollt határozza meg \cite{bib:osiwiki}} modell elsõ (fizikai) és második (adatkapcsolati) rétegét valósítja meg (\figref{lrwpan} ábra), erre építkezik a ZigBee \cite{bib:zigbee} cég által specifikált protokoll verem (\figref{zigbeestack} ábra), ami a hálózati és az alkalmazási réteggel egészíti ki.

\textbf{A fizikai réteg} átjárást biztosít a felette lévõ adatkapcsolati rétegnek és összeköttetést teremt a hardverrel, specifikálja a mûködési feszültséget, szabályozza a használandó frekvenciát, ami Európában 868-868.6 MHz, Észak-Amerikában 902-928 MHz, világszerte 2.4-2.4835 GHz-es ISM (Industrial, Scientific and Medical)\footnote{sávok, melyek szabadon használhatóak ipari, tudományos és orvosi területen} tartományban helyezkedik el.

\textbf{Az adatkapcsolati réteg}nek a feladata hibamentes átvitel biztosítása két pont között hibajavítással, hibajelzéssel és forgalomszabályozással. A biteket keretekbe ágyazva küldi a felsõbb rétegnek. Egy keret maximális mérete 127 bájt, formátuma a IEEE 802.15.4-2011-es szabványban specifikált.

%http://my.safaribooksonline.com/book/electrical-engineering/communications-engineering/9780137059355/zigbee-wireless-sensor-and-control-network/ch02lev1sec7
\begin{figure}[h]
	\centering	
	\begin{minipage}[b]{0.45\linewidth}
		\resizebox{5cm}{!}{
		\includegraphics{figures/lrwpan.png}}
	\caption{IEEE 802.15.4 protokoll rétegei}
	\label{fig:lrwpan}
	\end{minipage}
	\quad
	\begin{minipage}[b]{0.45\linewidth}
		\resizebox{9cm}{!}{
		\includegraphics{figures/zigbeestack.png}}
	\caption{ZigBee protokoll}
	\label{fig:zigbeestack}
	\end{minipage}
\end{figure}

\textbf{A hálózati réteg} feladata az eszközök hálózathoz való le- és felcsatlakozásának kezelése, illetve szomszédos eszközök felderítése.

\textbf{Az alkalmazási réteg} összeköti a hálózati réteg adatkommunikációs és menedzsment részét a ZDO (ZigBee Device Objects)-k között. A ZDO-k 
a kapcsolódó eszközök azonosításában és a kommunikáció titkosításában segédkeznek. 
\subsubsection{A protokoll jellemzõi}
\begin{description}

	\item[Alacsony fogyasztás:] A Zigbee protokollra épülõ eszközök alacsony fogyasztása abban rejlik, hogy alvó állapotból 30 ms alatt aktívra tudnak váltani, így képeses alacsony fogyasztású állapotban tartózkodni jelentõs késleltetés nélkül. 
	\item[Nagy hatótávolság:] A 868 MHz-es verziónál a BPSK (Binary Phase-Shift Keying) \cite{bib:network} és DSSS (Direct Sequence Spread Spectrum) technológiák keresztezésével érték el. A BPSK lényege, hogy a 0-1 és 1-0 átmenetet a vivõfrekvencia 180 fokos fordításával reprezentálja, így az átvitt információ jelentõs zajt képes elviselni. A 802.11-es szabvány DSSS-leírása egy adatbitnek egy 11 bites kódot feleltet meg, és ezt az adatbit és egy 11 bit hosszú úgynevezett Barker-sorozat(10110111000) kizáró vagy  kapcsolatával állítja elõ. Egy adatbitnek tehát 11 bit felel meg, sokszoros redundanciát hordozva.
	
	\item[Megbízhatóság:] A megbízhatóságot CSMA/CA (Carrier Sense Multiple Access Collision Avoidance) segítségével érték el. A módszer lényege, hogy mielõtt egy állomás jelet adna, megnézi, hogy a csatornán zajlik-e kommunikáció, és ha igen, akkor különbözõ stratégiák segítségével vár az üzenet újraküldésével.
	
\end{description}




Az XBee a Zigbee protokollt megvalósító bejegyzett márkaneve, melynek tulajdonosa a Digi cég.

\section{Földi irányító állomás}

Feladatom egy program formájában egy olyan grafikus felhasználói felülettel ellátott földi állomás elkészítése, ami képes a redundáns kommunikációs csatornák adatainak kezelésére és hatékony megjelenítésére. Ehhez szükséges a kapcsolat kiépítése a repülõgép és a földi állomás között, melynek során meg kell oldanom a soros porti kommunikáció létrehozását majd a fogadott független adatok feldolgozását és kijelzését.

\subsection{Mi a földi irányító állomás feladata?} 

Egy UAV vezetéséhez elengedhetetlen egy GCS (Ground Control Station), ahonnan a földi személyzet irányíthatja és monitorozhatja a repülést. Egy állomás általában több funkciót lát el \cite{bib:aimofuav}:
\begin{itemize}
\item Küldetés tervezése: útvonal meghatározása, illetve a célpontok kijelölése
\item Küldetés végrehajtása: az operátor távirányítással hajtja végre a feladatot
\item Adatok megjelenítése: megfelelõ módon jelzi a repülõgép állapotát, annak esetleges hibáit
\end{itemize}


\subsection{Hibatûrõ kommunikáció kialakítása}

A repülõgép és a fejlesztendõ program közti megbízható kommunikációhoz az alábbi feladatok megoldása szükséges:

\begin{itemize}
\item {Modem kommunikáció:}

A modem soros port interface-t biztosít, egy USB-RS232 átalakítóval USB porton keresztül megoldható egy olyan számítógéppel is az összeköttetés, mely nem rendelkezik soros porttal. Ilyen lehet például egy saját energiaellátással rendelkezõ modern laptop. Feladataim közé tartozik, hogy biztosítsam az útvonalpontok feltöltésének lehetõségét. Ehhez kétirányú kommunikáció kiépítése szükséges. 

\item {Párhuzamos csatornák:}

Mivel a repülõgépen duplikáltak az elemek, így a küldõ oldali modem is, a független jelek vételére megoldást kell találnom. Az esetleges eltérések kiértékelését és az ezen alapuló hibadetektációt meg kell oldanom.

\item {Biztonságos protokoll:}

Kétirányú kommunikáció kialakítása a cél, így a küldendõ adatok csomagjának biztonságos protokollját ki kell dolgozni, mely az adatintegritás megõrzése érdekében hibajelzésre alkalmazható.
\end{itemize}


\subsection{Grafikus felhasználói felület}

Ahhoz hogy a kialakítandó földi irányítóállomás kezelõfelülete kényelmes és hatékonyan használható legyen, célszerû több nézeti oldal elkészítése: 
\begin{itemize}
\item Egy áttekintõ képernyõ, mely a legfontosabb adatokat jeleníti meg a repülõvel kapcsolatban (pozíció, sebesség, irány)
\item Egy tervezõ modul, amin a lerepülendõ útvonalhoz tartozó fordulópontok kijelölése lehetséges
\item Egy diagnosztikai nézet, melyen az alacsonyabb prioritású adatok tekinthetõek át
\item A kommunikáció alacsony szintû megjelenítésére egy terminál ablak létrehozása, melyen a kapott nyers adatok látszódnak
\end{itemize}


\section{Földi irányító állomások bemutatása és összehasonlítása}

Számos megoldás született földi állomások GUI (Graphical User Interface)\footnote{grafikus megjelenítés}-jainak kialakítására. Elsõdleges követelmény, hogy az operátor mindig a legfontosabb információkat láthassa, ehhez szoftverergonómiailag kell megtervezni a grafikus felületet. Kísérleteket folytattak, milyen elrendezésben, hány képernyõn érdemes megjeleníteni az adatokat, úgy, hogy az még ne terhelje túl az operátort \cite{bib:multimodal}. Ebben a kísérletben bebizonyosodott, hogy pl. egy nagy prioritású eseménynél a figyelmeztetõ ablak megjelenésénél érdemes hangjelzést is adni. 

Alábbiakban bemutatom a piacon lévõ megjelenítési felületeket és megoldásokat, melyeket a fejezet végén összehasonlítok.


\subsection{ArduPilot}

Az Ardupilot projekt \cite{bib:ardu} létrejöttének oka, hogy otthoni körülmények között, nem ipari alkatrészekbõl bárki összeállíthasson egy autonóm jármûvet, mely az elõre betáplált utasításokat végrehajtja. Központi elem az Atmel cég által készített Atmel AVR mikroprocesszorra épülõ Arduino platform \cite{bib:arduino}. Az Arduino egy ,,system on a board'', aminek lényege, hogy a felhasználó egy elõre elkészített eszközt kap, amit egybõl a kívánt célra használhat fel. Az Arduino programozási nyelv segítségével az eszközzel ismerkedõ programozó magas szintû utasításokkal programozhatja az eszközt, nincs szükség alacsony szintû, assembly nyelvtudásra. Erre a platformra hozták létre az ArduPilot programot, ami képes többféle autonóm jármûvet vezérelni:

\begin{itemize}
\item ArduPlane néven futó változat: robotrepülõgép
\item ArduCopter: 1, 3, 4, 6, 8 propelleres helikopter
\item Ardurover: 4 kerekû autó
\end{itemize}
Sikerességének fõ oka a nyílt forráskód, az Arduino panel alacsony ára és a projekt mögött álló lelkes közösség. Ennek a közösségnek köszönhetõen született a Mission Planner nevû szoftver, mely teljes körû támogatást nyújt a csatlakoztatott jármûvek útvonaltervezéséhez, grafikus megjelenítéséhez.


\subsubsection{Fõképernyõ}

A program funkcionalitása több nézet segítségével könnyen átlátható. A \figref{ardu} ábrán látható fõképernyõn repülés szempontjából a legfontosabb adatok találhatóak. A repülõgép orientációját, sebességét, irányát egy mûhorizonton láthatja a felhasználó, ez vizuálisan szemlélteti, hogy hány fokos bedöntéssel repül, milyen állásszöggel emelkedik. Alatta lévõ területen elõre beállított adatokat jelenít meg, pl. GPS magasság, GPS sebesség, szélirány (valós mágneses irány és a sebesség vektor különbségébõl számítható). A felületen a legnagyobb területet a térkép foglalja el, melyen az aktuális irány, a lerepült útvonal és a fordulópontok láthatóak.

\begin{figure}[H]
	\centering
	\resizebox{15cm}{!}{
		\includegraphics{figures/ardu.png}}
	\caption{MissionPlanner }
	\label{fig:ardu}
\end{figure}

Ez a nézet akkor jöhet jól, ha olyan meghibásodás történik, melyre nincs felkészítve az irányítóegység és szükség lehet a kézi üzemmódra váltásra. Ilyen esetben elõfordulhat, hogy nincs vizuális kapcsolat az operátor és a repülõgép között. Ilyen esetben csak a képernyõn látható mûszerek és térkép alapján lehetséges a repülõgép irányítása.

\subsubsection{Tervezõ és útvonalfeltöltõ képernyõ}

A tervezõ nézet lehetõséget biztosít a lerepülendõ útvonal meghatározására. Az útvonalat meghatározó útvonalpontok típusa (indulási-, forduló- vagy végpont (\figref{ardu_plan} ábra)) egy listából választható. Az útvonalpontok pozíciója egérrel módosítható, törölhetõ. A képernyõ bal felsõ sarkában a kijelölt útvonaltervnek hossza látható. Ennek segítségével elkerülhetõ, hogy a repülés során a gép túllépje a rádiókapcsolat és a saját hatósugarát. Az elkészített tervet feltölthetjük a csatlakoztatott eszközre.

\begin{figure}[H]
	\centering
	\resizebox{15cm}{!}{
		\includegraphics{figures/ardu_plan.png}} %plan
	\caption{MissionPlanner tervezõképernyõ, pontok típusai}
	\label{fig:ardu_plan}
\end{figure}

A program jobb felsõ sarkában a ``Csatlakozás'' gomb mindig látható, itt a soros port és a jelsebesség beállítása után ezzel a gombbal csatlakozik a program a kiválasztott portra.


\subsubsection{Összegzés}
A Mission Planner program felhasználói szempontból kényelmes felületet biztosít a különbözõ nézetekkel és a gombok átgondolt elhelyezésével. Az ArduPilot projekt egyszerûsége miatt nincs felkészítve párhuzamos csatornák kezelésére, mert az egész projekt nem használ redundanciát.  Jó ötlet a ``Csatlakozás'' gomb mindig látható elhelyezése, a repülõgép helyzetének fõképernyõn, egy térképen való megjelenítése, illetve orientációjának a mûhorizont segítségével történõ mutatása. Hátrányai között szerepel, hogy a hibadiagnosztikai kijelzés nem megoldott.


\subsection{Paparazzi}
Az ArduPilot-hoz hasonlóan a Paparazzi projekt \cite{bib:paparazzi} is a könnyen, otthon összeszerelhetõ repülõ megépítése jegyében született. Nem csak egy nyílt forráskódú robotpilótát ad, hanem egy komplett ``csináld magad'' készletet, amelyben a feszültségszabályzótól kezdve a GPS vevõig minden biztosított, a hozzá készült földi állomáshoz antennát, modemet és programot is rendelkezésre bocsájt.

A program a következõ funkciókkal rendelkezik:

\begin{itemize}
\item több platform támogatása (fix- és forgószárny)
\item több jármû egyidejû kezelése
\item Google Maps, OpenStreetMaps, Microsoft Maps térképes megjelenítése
\item küldetéstervezés
\item hangjelzés
\end{itemize}


\subsubsection{Fõképernyõ}

\begin{figure}[h]
	\centering
	\resizebox{15cm}{!}{ 
		\includegraphics{figures/paparazzi.png}} %conn
	\caption{Paparazzi program}
	\label{fig:paparazzi}
\end{figure}

Az \figref{paparazzi} ábrán látható képernyõ jelentõs részét a térkép foglalja el, melyen a csatlakoztatott jármûvek lerepült útvonala (különbözõ színnel jelölve) és a fordulópontok láthatóak. A jármûvek aktuális helyzete mellett a jármû neve, sebessége és repülési magassága is kijelzésre kerül. Bal oldalon az információs sávban mindegyik eszköz fontosabb adatai láthatóak: akkumulátor töltöttsége, sebesség, tolóerõ, magasság, illetve utasítások: fel-, leszállás, megfigyelés indítása. A jobb felsõ sarokban a kurzor térképen lévõ koordinátája látszik. 


A térkép billentyûzet és egér segítségével mozgatható, nagyítható. A fordulópontok is ezen a felületen szerkeszthetõek. A módosítások egy figyelmeztetõ üzenet jóváhagyása után töltõdnek fel a repülõre, melyre az egy megerõsítõ válasszal reagál. Új pontot csak felszállás elõtt lehetséges feltölteni.

A képernyõ alsó részének közepén egy több füllel ellátott rész található, ahol kiválasztható, hogy egy mûhorizont, a GPS által vett adatok, az útvonalterv vagy a beállítások látszódjanak-e.

\subsubsection{Összegzés}
Ugyanaz a képernyõ szolgál a navigációra és az útvonal-kijelölésre, ami szerintem nem a legjobb megoldás, mivel nincs elválasztva ez a két funkcionalitás. Egyértelmûbb, ha a program a tervezéshez egy olyan perspektívát nyújt, ahol minden szükséges információ rendelkezésre áll az útvonallal kapcsolatban. Repülés közben ezek az információk nem szükségesek, sõt zavaróak is lehetnek. Összességében ez is egy nagyon jól használható program, ami minden olyan funkciót biztosít, mely egy UAV használatához szükséges.

\subsection{MicroPilot Horizon}
\label{sect:micropilot}
``Az 1995 óta mûködõ kanadai MicroPilot \cite{bib:micropilot} a világ egyik legismertebb robotpilóta gyártó cége, 65 országban több mint 750 alkalmazó használja az eszközeiket. Népszerûek az iskolákban, egyetemeken, kutató intézetekben, a gazdaság különbözõ területein, de a védelmi szféra is szép számmal használ robot légi jármûvein MicroPilot berendezéseket. Az adatátviteli csatorna ugyanazokat a funkciókat képes biztosítani, mint a programbevitelnél használt kábeles összeköttetés, így ezen keresztül repülés közben is módosítható az útvonal, a repülési paraméterek és az egyéb beállítások. A MicroPilot fedélzeti egysége ezen kívül egy rádió távirányító vevõberendezést is fogad, amely lehetõséget teremt a földi adó konzoljáról az irányítás átvételére és botkormányos kézi vezérlésre. Ezt alapvetõen a fel és leszállás idejére, illetve az útvonal kritikus szakaszain használják. Amennyiben az RC távirányítóval mûködõ repülõgép veszti el a kapcsolatot, akkor a fedélzeti vevõberendezés Failsafe üzemmódra kapcsol és annak beállítása szerint mûködteti a repülõgépet. A Failsafe vagy az utolsó szervó állást õrzi meg, vagy egy elõre programozott legbiztonságosabb földet érést ígérõ beállításra ugrik.''\cite{bib:makkay} 

A hozzá készített földi irányító egység a MicroPilot Horizon nevet viseli. 

\begin{figure}[h]
	\centering	
	\begin{minipage}[b]{0.45\linewidth}
		\centering
			\resizebox{10cm}{!}{ 
		\includegraphics{figures/micropilot.png}} 
	\caption{MicroPilot fõképernyõje}
	\label{fig:micropilot}
	\end{minipage}
	\quad
	\begin{minipage}[b]{0.45\linewidth}
		\centering
	\resizebox{4cm}{!}{ 
		\includegraphics{figures/microhud.png}} 
	\caption{MicroPilot kamera képe}
	\label{fig:micropilothud}
	\end{minipage}
\end{figure}


\subsubsection{Fõképernyõ}

A repülõgépre szerelt kamera képének megjelenítése kulcsfontosságú, mivel a kezelõ ezzel láthatja leginkább a repülõgép helyzetét és a megfigyelt célpontot. Ebben a módban a legfontosabb repüléssel kapcsolatos információk átlátszó háttérrel jelennek meg, így nem kell másik képernyõre tekintenie a kezelõnek.
A program egyszerre több eszközhöz tud csatlakozni és azokat kiszolgálni, melyekhez külön név rendelhetõ. Az útvonalpontok az összes csatlakoztatott jármû között szinkronizáltak. A szakdolgozat feladata  szempontjából érdekes lehet, hogy a felmerülõ hibákhoz lehetõség kínálkozik különbözõ prioritási szintek meghatározására és hangjelzés hozzárendelésére. Így egy bizonyos szint alatti hibák nem terelik el az operátor figyelmét.

\subsubsection{Tervezõ képernyõ}

A repülési terv könnyen, kattintással összeállítható és módosítható, repülés elõtt és közben egyaránt. Az útvonal hossza folyamatosan kijelzésre kerül tervezés üzemmódban.

\subsubsection{Összegzés}

Ez a program elsõsorban távirányításos vezérlés támogatására készült, aminek során az operátor irányítja a gépet. Így kulcsfontosságú a videókép átvitel támogatása és a legfelhasználóbarátabb megjelenítés. Érdekesség a POI (Points Of Interest)\footnote{GPS koordinátával megjelölhetõ érdekes hely} gomb, mellyel egy pozíció késõbbi kivizsgálásra megjelölhetõ, ha esetleg valami olyat lát az operátor, melyet érdemes felkeresni.


%http://www.szrfk.hu/rtk/folyoirat/2013_1/2013-1-04-Imre_Makkay.pdf
%http://www.szrfk.hu/rtk/kulonszamok/2012_cikkek/77_Makkay_Imre-Papp_Timea.pdf
%http://www.unmannedgroup.com/index.php?page=2&subpage=6&data=9
%http://www.uavfactory.com/product/16


\subsection{OpenPilot}
Az OpenPilot projekt \cite{bib:openpilot} célja, hogy nyílt forráskódú, magas minõségû robot pilótát kínáljon autonóm légijármûvek vezérléséhez. A projekt 2009-ben alakult, azóta már több mint 200 tagja vesz részt a fejlesztésben a világ 140 országából. A jelenlegi verzió képes irányítani fix szárnyas repülõt és helikoptert kettõtõl nyolc rotorig. 

A hozzá készült földi irányító program több platformon mûködik: Windows, Mac OS, Linux és tervben van az Android támogatása is. Ez a program nem csupán az elõbbi programok funkcióival bír (útvonal tervezés, megjelenítés), hanem a fedélzeti számítógépet tartalmazó panel felprogramozására is alkalmas.

\subsubsection{Fõképernyõ}

A képernyõ bal oldalán egy mûhorizont látható, alatta a jármû orientációja látszik külsõ nézetbõl, míg jobb oldalon a térkép az aktuális pozíciót jeleníti meg.

Ez a nézet szabadon módosítható különféle ``gadget''-ek kiválasztásával, pl. a külsõ nézet egy mért érték grafikus megjelenítésére kicserélhetõ. Egy .xml fájlba elmenthetõek és visszatölthetõek, így igazodva különbözõ a konfigurációk igényeihez.

\subsubsection{Összegzés}
A projekt mögött egy igen lelkes és aktív közösség áll, hiszen az OpenPilot minden olyan fontos igényt kielégít, mely napjainkban felmerülhet egy UAV adatainak megjelenítésével és konfigurálásával kapcsolatban.

\begin{figure}[H]
	\centering
	\resizebox{15cm}{!}{ 
		\includegraphics{figures/openpilot.png}} 
	\caption{OpenPilot fõképernõje}
	\label{fig:openpilot}
\end{figure}


\subsection{Egyéb megoldások}

\subsubsection{QGroundControl}
Ez a program \cite{bib:qground} nyílt forráskódú és a MAVLink\footnote{pehelysúlyú protokoll, C nyelvû header fájlok írják le. Változó csomagformátumú, egy csomag tartalmazza a tartalmának típusát, melyet a fogadó oldal felhasznál az adattartalom értelmezéséhez.} protokollt használja a csatlakoztatott eszközzel történõ kommunikációra. Érdekesség, hogy a program a repülõgép aktuális pozícióját a \figref{qground} ábrán látható módon 3D-ben is meg tudja jeleníteni és videókép fogadására is alkalmas. Az útvonalpontok szerkesztése felszállás után is lehetséges. A protokollnak köszönhetõen a program képes 255 jármû egyidejû kezelésére.
\begin{figure}[h]
	\centering
	\resizebox{15cm}{!}{
		\includegraphics{figures/qground.png}}
		\caption{QGroundControl program}
	\label{fig:qground}
\end{figure}

\subsubsection{HappyKillmore}
\label{sect:happy}
Az ArduPilot-hoz készült nyílt forráskódú GCS \cite{bib:hk} a Mission Planner-hez képest inkább az egyszerûség híve. Kevés mûszer található rajta, de ezekrõl minden információ megtudható (\figref{hk} ábra). Itt is a térkép nézet dominál, a képernyõ oldalsó részén mozgathatjuk számunkra megfelelõ elrendezésbe a mûszereket. Útvonalpontok feltöltésére szintén van lehetõség. A program támogatja többek között az ArduPilot és a MAVLINK protokollokat.

\begin{figure}[H]
	\centering
	\resizebox{14cm}{!}{
		\includegraphics{figures/hk.png}}
		\caption{HappyKillMore program}
	\label{fig:hk}
\end{figure}



\subsection{Összehasonlítás}

A fentebb bemutatott földi irányító állomások tulajdonságait a \tabref{compare} táblázatban foglaltam össze. Látható, hogy megoldások forráskódja elég változatos a választott nyelv tekintetében. A nyílt forráskódúak az összes napjainkban használat programozási nyelvet felhasználják. Ezek tanulmányozásával ötleteket lehet meríteni a tervezéshez és megvalósításhoz.

Az összes vizsgált megoldásra jellemzõ, hogy a repülõgép pozíciója valamilyen térképen kerül megjelenítésre. Általában a fõképernyõn a sebesség és a magasság adatok mindig láthatók, így az elkészítendõ felületre célszerû egy térképes megjelenítést és a legfontosabb információk kijelzését megoldani. 

Számos program különválasztotta az útvonal-kijelölés felületét a fõképernyõtõl, így ebbõl merítve készíthetõ egy olyan felület, melyen útvonalpontok hozzáadhatóak, módosíthatóak és feltölthetõk. 

Hasznos funkció az útvonal repülés közbeni módosítása, ezért érdemes ezt a lehetõséget beépíteni az elkészítendõ programba.

Néhány megoldás több eszköz párhuzamos kiszolgálását támogatta, jelenleg a feladatom egy eszközhöz való csatlakozás megoldása, ám ha szükséges, látható, ez nem egy megoldhatatlan probléma.

Egyik sem alkalmaz redundanciát a kommunikáció megvalósítására, így a dolgozat szempontjából érdekes hibadetektációra nem találtam példát.
A repülõgép, melyhez a programot készítem, nagy megbízhatóságú, így adatai duplikált csatornán küldi. Ezért a két port kezelése és az azokon érkezõ adatok feldolgozása megoldandó probléma.

A MicroPilot program (\sectref{micropilot} fejezet) elsõdleges funkciója a repülõgép távvezérléséhez kapcsolatos információk kijelzése, ezért az operátort különféle üzenetekkel figyelmezteti például elõre beállított tiltott légtér megközelítése. Ilyen figyelemfelkeltõ üzeneteket érdemes használni hibadetektálás eredményének kijelzésére.


\begin{table}[H]
	\begin{center}
	\resizebox{!}{125px}{
			\begin{tabular}{| l | l | l | l  | l | l | }
				\hline
				%Program		 			& Forráskód 							&Több          			 &Útvonal  						 & Elõny 					  	\\
				%								&													&eszköz							 &szerkesztése				 &										\\ \hline
			%	Ardupilot				& C\#, nyílt 							& 		-				  		 &				-						 & - 									\\ \hline
			%	Paparazzi 			& ?, nem nyílt						&			+							 &				-					   & 	-									\\ \hline
				%MicroPilot 			& ?, nem nyílt						&			+							 &				+				     & hangjelzéses figyelmeztetés	 	\\ \hline
				%QGroundControl 	& C++, nyílt							&			+							 &				-					   & 	-									\\ \hline
				%HappyKillMore 	& Visual Basic, nyílt			&			-							 &				-					   & 	-									\\ \hline
				
				\hline
				\textbf{Program}    	& \textbf{Ardupilot}			&\textbf{Paparazzi}	 &\textbf{MicroPilot}		& \textbf{QGround} & 	\textbf{Happy}			\\ 
				          						& \textbf{MissionPlanner} & 		            	 &             				 &  \textbf{Control}&		 \textbf{Killmore}	\\ \hline
				Forráskód							& C\#, nyílt 							& 		?, nem nyílt	 &?, nem nyílt				 & C++, nyílt 	            &		VB, nyílt		\\ \hline
				Térképes 							&       		+							 &				 +				   & 	 	+							&					+		              &  +            \\ 
				vizualizáció					&       									 &									   &    								&							              &             \\ \hline
				Tervezés 							&       		+							 &				 -				   & 	 	+							&					+		              &  +            \\ 
				képernyõ    					&       									 &									   &    								&							              &             \\ \hline
				Több eszköz 					&     		        				&			 							 &				 					   & 	         		            &			          \\ 
				egyidejû  						& -												&			+							 &				+				     & +	                      &	 +            \\ 
				kezelése    					&     		        				&			 							 &				 					   & 	        		            &			          \\ \hline
				Útvonal 							& -												&			+							 &				+				     & -	                      &	  ?           \\ 
				szerkesztése 					&    											&			 							 &				  			     &  	                      &	              \\ 
				``on-the-fly''				&    											&			 							 &				  			     &  	                      &               \\ \hline
				Figyelmeztetés				&   -          						&			-							 &				+					   & 	+	                      &  -            \\ \hline
				Redundáns					    &       		-							 &				 -				   & 	 -							&					-		              & -             \\  
				hibatûrés					    &       									 &									   &    								&							              &             \\ \hline
				                                                                                                                                      
				
			\end{tabular}   }                                                                      
	\end{center}
	\caption{Földi irányító állomások összehasonlítása}
	\label{tab:compare}
\end{table}
